rm(ls())
q()
n
q()
n
q()
n
q()
n
########################################################
# Author: Diego Valle-Jones
# Website: www.diegovalle.net
# Date Created: Sat Dec 24 17:09:48 2011
# Email: diegovalle at gmail.com
# Purpose: Clean a bunch of homicide files
# Copyright (c) Diego Valle-Jones. All rights reserved
library(compiler)
library(ggplot2)
library(stringr)
library(gdata)
library(classInt)
library(stringr)
library(car)
library(Hmisc)
library(geosphere)
library(Cairo)
library(plyr)
library(reshape)
library(rgdal)
library(maptools)
library(memoise)
library(data.table)
library(doMC)
library(directlabels)
library(mi)
registerDoMC(2)
gpclibPermit()
theme_set(theme_bw())
options(stringAsFactors = FALSE)
kUrbanThreshold <- 2500
#Clean the population data
if(!file.exists("cache/population.RData")) {
source("src/clean_population.R")
} else {
load("cache/population.RData")
}
#Clean the homicide files with age groups
if(!file.exists("clean-data/homicides-agegroup-sex1990-2010.csv.bz2") |
!file.exists("cache/agerates.RData")) {
source("src/clean_age_adjusted.R")
} else {
load("cache/agerates.RData")
}
#Clean the homicide files without age groups
source("src/clean_homicides.R")
head(hompop)
ma <- read.csv("data/municipality-heads.csv")
head(ma)
whorates <- merge(hompop, ma, by =c("id"), all.x = TRUE)
head(whorates)
whorates <- subset(whorates, DistUSBorder <= 160)
ddply(whorates, .(Year), summarise, Rate = sum(TotalHomicides) / sum(TotalPopulation) * 10^5)
ddply(whorates, .(Year), summarise, Rate = sum(TotalHomicides))
ddply(whorates, .(Year), summarise, Rate = sum(TotalHomicides) / sum(TotalPopulation) * 10^5)
whorates <- subset(whorates, DistUSBorder <= 100)
ddply(whorates, .(Year), summarise, Rate = sum(TotalHomicides))
ddply(whorates, .(Year), summarise, Rate = sum(TotalHomicides) / sum(TotalPopulation) * 10^5)
whorates <- subset(whorates, DistUSBorder <= 160)
ddply(whorates, .(Year), summarise, Rate = sum(TotalHomicides))
ddply(whorates, .(Year), summarise, Rate = sum(TotalHomicides) / sum(TotalPopulation) * 10^5)
border <- ddply(whorates, .(Year), summarise, Rate = sum(TotalHomicides) / sum(TotalPopulation) * 10^5)
dput(border[10:21])
border <- ddply(whorates, .(Year), summarise, Rate = sum(TotalHomicides) / sum(TotalPopulation) * 10^5)
dput(border[10:21])
border
dput(border[10:21],)
dput(border[10:21,])
########################################################
## Author: Diego Valle-Jones
## Website: www.diegovalle.net
## Date Created: Thu Sep  6 17:33:20 2012
## Email: diegovalle at gmail.com
## Purpose: Analyze violence in Central America and Southern Mexico
## Copyright (c) Diego Valle-Jones. All rights reserved
library(RColorBrewer)
library(lubridate)
library(ggplot2)
library(stringr)
library(reshape2)
library(plyr)
library(reshape)
library(maptools)
library(rgdal)
library(geosphere)
library(raster)
gpclibPermit()
hom.ca <- read.csv("data/UNhomicides.csv")
setwd("~/Documents/personal/Math/drug-war/central-america")
hom.ca <- read.csv("data/UNhomicides.csv")
View(hom.ca)
ggplot(hom.ca, aes(Year, Rate, group = Country.or.Area)) +
geom_line()
library(directlabels)
p <- ggplot(hom.ca, aes(Year, Rate, group = Country.or.Area,
color = Country.or.Area)) +
geom_line()
direct.label(p)
direct.label(p, "last.bumpup")
p <- ggplot(hom.ca, aes(Year, Rate, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
xlim(1995, 2013)
p <- ggplot(hom.ca, aes(Year, Rate, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
xlim(1995, 2016)
direct.label(p, "last.bumpup")
p <- ggplot(hom.ca, aes(Year, Rate, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
xlim(1995, 2014.6)
direct.label(p, "last.bumpup")
p <- ggplot(hom.ca, aes(Year, Rate, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
xlim(1995, 2014.4)
direct.label(p, "last.bumpup")
p <- ggplot(hom.ca, aes(Year, Rate, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
xlim(1995, 2014)
direct.label(p, "last.bumpup")
hom.ca <- subset(hom.ca, Year >= 2000)
ddply(hom.ca, .(Country.or.Area), transform,
per = Rate / Rate[1])
ddply(hom.ca, .(Country.or.Area), transform,
per = Rate[1] / Rate)
ddply(hom.ca, .(Country.or.Area), transform,
per = Rate / Rate[1])
ddply(hom.ca, .(Country.or.Area), transform,
per = Rate[1] / Rate)
ddply(hom.ca, .(Country.or.Area), transform,
per = Rate / Rate[length(Rate)])
p <- ggplot(hom.ca, aes(Year, Rate, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
xlim(1995, 2014)
direct.label(p, "last.bumpup")
p <- ggplot(hom.ca, aes(Year, per, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
xlim(1995, 2014)
direct.label(p, "last.bumpup")
hom.ca <- ddply(hom.ca, .(Country.or.Area), transform,
per = Rate / Rate[length(Rate)])
p <- ggplot(hom.ca, aes(Year, per, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
xlim(1995, 2014)
direct.label(p, "last.bumpup")
scale_x_continuous(labels = percent)
xlim(1995, 2014)
p <- ggplot(hom.ca, aes(Year, per, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
scale_x_continuous(labels = percent)
xlim(1995, 2014)
direct.label(p, "last.bumpup")
p <- ggplot(hom.ca, aes(Year, per, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
scale_x_continuous(labels = percent) +
xlim(1995, 2014)
direct.label(p, "last.bumpup")
library(scales)
p <- ggplot(hom.ca, aes(Year, per, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
scale_x_continuous(labels = percent) +
xlim(1995, 2014)
direct.label(p, "last.bumpup")
p <- ggplot(hom.ca, aes(Year, per, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
scale_y_continuous(labels = percent) +
xlim(1995, 2014) +
ggtitle("Homicides in Central America as a percent of 2000")
direct.label(p, "last.bumpup")
p <- ggplot(hom.ca, aes(Year, Rate, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
xlim(1995, 2014) +
ggtitle("Homicide Rates in Central America")
direct.label(p, "last.bumpup")
p <- ggplot(hom.ca, aes(Year, Rate, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
xlim(1995, 2014) +
ggtitle("Homicide Rates in Central America")
p <- ggplot(hom.ca, aes(Year, per, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
scale_y_continuous(labels = percent) +
xlim(1995, 2014) +
ggtitle("Homicides in Central America as a percentage of 2000")
p <- ggplot(hom.ca, aes(Year, per, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
scale_y_continuous(labels = percent) +
xlim(1995, 2014) +
opts(title = "Homicides in Central America as a percentage of 2000")
direct.label(p, "last.bumpup")
p <- ggplot(hom.ca, aes(Year, Rate, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
xlim(1995, 2014) +
opts("Homicide Rates in Central America")
direct.label(p, "last.bumpup")
hom.ca <- read.csv("data/UNhomicides.csv")
p <- ggplot(hom.ca, aes(Year, Rate, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
xlim(1995, 2014) +
opts(title = "Homicide Rates in Central America")
direct.label(p, "last.bumpup")
ggsave("graphs/hom-ca.pn", dpi = 100,
width = 8, height = 6)
hom.ca <- subset(hom.ca, Year >= 2000)
hom.ca <- ddply(hom.ca, .(Country.or.Area), transform,
per = Rate / Rate[length(Rate)])
p <- ggplot(hom.ca, aes(Year, per, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
scale_y_continuous(labels = percent) +
xlim(1995, 2014) +
opts(title = "Homicides in Central America as a percentage of 2000")
direct.label(p, "last.bumpup")
ggsave("graphs/hom-ca-percentage.pn", dpi = 100,
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
width = 8, height = 6)
ggsave("graphs/hom-ca.pn", dpi = 100,
width = 8, height = 6)
hom.ca <- read.csv("data/UNhomicides.csv")
p <- ggplot(hom.ca, aes(Year, Rate, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
xlim(1995, 2014) +
opts(title = "Homicide Rates in Central America")
direct.label(p, "last.bumpup")
ggsave("graphs/hom-ca.png", dpi = 100,
width = 8, height = 6)
hom.ca <- subset(hom.ca, Year >= 2000)
hom.ca <- ddply(hom.ca, .(Country.or.Area), transform,
per = Rate / Rate[length(Rate)])
p <- ggplot(hom.ca, aes(Year, per, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
scale_y_continuous(labels = percent) +
xlim(1995, 2014) +
opts(title = "Homicides in Central America as a percentage of 2000")
direct.label(p, "last.bumpup")
ggsave("graphs/hom-ca-percentage.png", dpi = 100,
width = 8, height = 6)
p <- ggplot(hom.ca, aes(Year, per, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
scale_y_continuous(labels = percent) +
xlim(1995, 2014) +
ylab("homicides as a percentage in 2000") +
opts(title = "Homicides in Central America as a Percentage of 2000")
direct.label(p, "last.bumpup")
ggsave("graphs/hom-ca-percentage.png", dpi = 100,
width = 8, height = 6)
p <- ggplot(hom.ca, aes(Year, per, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
scale_y_continuous(labels = percent) +
xlim(1995, 2014) +
ylab("homicide rate as a percentage that in 2000") +
opts(title = "Homicide Rates in Central America as a Percentage of those in 2000")
direct.label(p, "last.bumpup")
ggsave("graphs/hom-ca-percentage.png", dpi = 100,
width = 8, height = 6)
hom.ca <- read.csv("data/UNhomicides.csv")
p <- ggplot(hom.ca, aes(Year, Rate, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
xlim(1995, 2014) +
opts(title = "Homicide Rates in Central America")
direct.label(p, "last.bumpup")
ggsave("graphs/hom-ca.png", dpi = 100,
width = 8, height = 5)
hom.ca <- subset(hom.ca, Year >= 2000)
hom.ca <- ddply(hom.ca, .(Country.or.Area), transform,
per = Rate / Rate[length(Rate)])
p <- ggplot(hom.ca, aes(Year, per, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
scale_y_continuous(labels = percent) +
xlim(1995, 2014) +
ylab("homicide rate as a percentage that in 2000") +
opts(title = "Homicide Rates in Central America as a Percentage of those in 2000")
direct.label(p, "last.bumpup")
ggsave("graphs/hom-ca-percentage.png", dpi = 100,
width = 8, height = 5)
p <- ggplot(hom.ca, aes(Year, per, group = Country.or.Area,
color = Country.or.Area)) +
geom_line() +
scale_y_continuous(labels = percent) +
xlim(1995, 2014) +
ylab("homicide rate as a percentage of that in 2000") +
opts(title = "Homicide Rates in Central America as a Percentage of those in 2000")
direct.label(p, "last.bumpup")
ggsave("graphs/hom-ca-percentage.png", dpi = 100,
width = 8, height = 5)
